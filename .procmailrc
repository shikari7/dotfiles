# $Id$	

# To Do:
# o Subject: get pgp key
# x Subject: TOGGLE ISP (UP|DOWN)
# o send me a given file

#Set on when debugging
VERBOSE=off
 
# supposedly this is necessary for (t)csh users?  (haven't needed it AFAIK)
SHELL=/bin/sh

#Replace `mail' with your mail directory (Pine uses mail, Elm uses Mail)
MAILDIR=$HOME/Mail
     
#Directory for storing procmail log and rc files
PMDIR=$HOME/.procmail
     
# mobile address
PAGER=6123250594@mobile.att.net

# catch any duplicates with a Message-ID cache (before logging)
#:0 Wh: $PMDIR/msgid.lock
#| formail -D 65536 $PMDIR/msgid.cache

MONTH=`date +%m`
YEAR=`date +%Y`

# common variables for use later
nl	 = ""
dq	 = '"'
bs	 = "\\"
ws	 = "[	    ]*(\([^()]*\)[	 ]*)?"
digit	 = "[0-9]"
day	 = "(Mon|Tue|Wed|Thu|Fri|Sat|Sun)"
month	 = "(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)"
hour	 = "$digit$digit:$digit$digit(:$digit$digit)?"
zone	 = "((UT|GMT|EST|EDT|CST|CDT|MST|MDT|PST|PDT|([A-I]|[K-Z]))|(+|-)$digit$digit$digit$digit)"
time	 = "$hour$ws$zone"

# logging
LOGDIR=$PMDIR/log/$YEAR
DUMMY=`test -d $LOGDIR || mkdir -p $LOGDIR`
LOGFILE=$LOGDIR/$MONTH

#:0
#* ^Subject: page me
#| sendpage -p XXXXXXXXXX -s %s

# page me with the current forecast (defaults to Boston)
:0
* ^Subject: send forecast
| forecast | mail -s forecast $PAGER

# txt me
#:0
#* < 1000
#! 

# archive all root mail
ROOT=$MAILDIR/root/$YEAR
DUMMY=`test -d $ROOT || mkdir -p $ROOT`
:0 c
* ^TOroot@
$ROOT/$MONTH

# archive all tcp-wrappers portmap reports
PORTMAP=$MAILDIR/portmap/$YEAR
DUMMY=`test -d $PORTMAP || mkdir -p $PORTMAP`
:0 c
* ^From:.*bin@
* ^Subject: portmap
$PORTMAP/$MONTH

# roll our own FROM macro (from Procmail FAQ)
FROM="(From[	]|(Old-|X-)?(Resent-)?(From|Reply-To|Sender):)(.*\<)?"

# try to catch spam (commented out now)
#INCLUDERC=$PMDIR/rc.spam

# mailing list rules and archives
SPOOLDIR=$MAILDIR/mail-incoming
DUMMY=`test -d $SPOOLDIR || mkdir -p $SPOOLDIR`
LISTSDIR=$MAILDIR/lists/$YEAR/$MONTH
DUMMY=`test -d $LISTSDIR || mkdir -p $LISTSDIR`
INCLUDERC=$PMDIR/rc.maillists

# filter mail from myself (but from Outlook) into my outgoing folders
#:0
#* ^From:.*edh@mr.net
#* !^TO.*edh@mr.net
#* ^X-MSMail-Priority:
#| tee -a $MAILDIR/archive/mail-outgoing/$YEAR/$MONTH /var/mail/edh

MINDSPRING=$MAILDIR/mindspring/$YEAR
DUMMY=`test -d $MINDSPRING || mkdir -p $MINDSPRING`
# filter out my Earthlink mail (which seems to be entirely SPAM)
:0
* ^TOmerlinus@mindspring.com
* !^From:.*@earthlink.net
$MINDSPRING/$MONTH

# global copies of everything not already sent somewhere (e.g. bitbucket)
ARCHIVEDIR=$MAILDIR/archive/mail-incoming/$YEAR
DUMMY=`test -d $ARCHIVEDIR || mkdir -p $ARCHIVEDIR`
MONTHFOLDER=$ARCHIVEDIR/$MONTH
:0 c
* < 204800
$MONTHFOLDER

# send copies of some mail to my pager
##:0 c
# nothing from certain people
##* !^FROM_DAEMON
##* !^From.*Eric.*Hendrickson
# nothing bigger than 10K
##* < 10240
# no mail lists
##* !^TO.*/dev/null
# try to weed out other forwards
##* !^Subject: F(W|w):
##| resend-mbox -r $PAGER -m -p

# safety net - keep backups of my last 32 messages
:0 c
backup
:0 ic
| cd backup && rm -f dummy `ls -t msg.* | sed -e 1,32d`

# Spam Assassin
:0fw
| /usr/bin/spamassassin -P -c /usr/share/spamassassin

:0:
* ^X-Spam-Status: Yes
SPAM
